<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="ETF Monitor" />
  <meta name="theme-color" content="#080c14" />
  <title>ETF Monitor</title>
  <link rel="apple-touch-icon" href="icon.png" />
  <link rel="manifest" href="manifest.json" />
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
  <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&display=swap');
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; background: #080c14; color: #e2e8f0; font-family: 'DM Mono', monospace; overflow: hidden; }
    #root { height: 100%; display: flex; flex-direction: column; }
    .main-layout { display: flex; flex: 1; overflow: hidden; }
    .sidebar { width: 220px; border-right: 1px solid #1e293b; flex-shrink: 0; display: flex; flex-direction: column; overflow-y: auto; }
    .sidebar-list { flex: 1; overflow-y: auto; }
    .detail-panel { flex: 1; overflow-y: auto; padding: 20px; }
    .sticky-header { position: static; }
    /* ëª¨ë°”ì¼ ì „ìš© */
    @media (max-width: 600px) {
      .sidebar { width: 100% !important; border-right: none; }
      .detail-panel { padding: 12px; width: 100% !important; }
      .detail-panel.mobile-detail-only .sticky-header {
        position: sticky; top: 0; z-index: 10;
        background: #0a1020;
        padding-bottom: 12px;
        border-bottom: 1px solid #1e293b;
        margin-bottom: 12px;
      }
    }
    ::-webkit-scrollbar { width: 3px; }
    ::-webkit-scrollbar-track { background: #080c14; }
    ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 4px; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
    @keyframes spin { to{transform:rotate(360deg)} }
    @keyframes fadeIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
    .fade-in { animation: fadeIn 0.3s ease both; }
    button { font-family: inherit; cursor: pointer; }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const WORKER_URL = "https://kis-proxy.yusunghwan.workers.dev";
const API = WORKER_URL;

// ETF ëª©ë¡ì€ Cloudflare KVì—ì„œ ë™ì ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.

// â”€â”€ ì§€í‘œ ê³„ì‚° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const calcEMA = (data, p) => {
  const k = 2/(p+1); const res = []; let prev = null;
  data.forEach((v,i) => {
    if(i < p-1){res.push(null);return;}
    if(prev===null) prev = data.slice(0,p).reduce((s,x)=>s+x,0)/p;
    const cur = v*k+prev*(1-k); res.push(+cur.toFixed(2)); prev=cur;
  });
  return res;
};

const calcRSI = (closes, p=14) => {
  const res = Array(closes.length).fill(null);
  if(closes.length < p+1) return res;
  let g=0,l=0;
  for(let i=1;i<=p;i++){const d=closes[i]-closes[i-1]; if(d>0)g+=d; else l-=d;}
  let ag=g/p, al=l/p;
  res[p] = al===0?100:+(100-100/(1+ag/al)).toFixed(2);
  for(let i=p+1;i<closes.length;i++){
    const d=closes[i]-closes[i-1];
    ag=(ag*(p-1)+Math.max(d,0))/p; al=(al*(p-1)+Math.max(-d,0))/p;
    res[i] = al===0?100:+(100-100/(1+ag/al)).toFixed(2);
  }
  return res;
};

// ì¼ë´‰/ì£¼ë´‰/ì›”ë´‰ ë³€í™˜ (ì¼ë´‰ ë°ì´í„°ë¥¼ ì§‘ê³„)
const groupCandles = (candles, unit) => {
  if(unit === "D") return candles;
  const groups = {};
  candles.forEach(c => {
    let key;
    const d = c.rawDate; // YYYYMMDD
    if(unit === "W") {
      // í•´ë‹¹ ë‚ ì§œê°€ ì†í•œ ì£¼ì˜ ì›”ìš”ì¼ ê¸°ì¤€
      const date = new Date(d.slice(0,4), d.slice(4,6)-1, d.slice(6,8));
      const day = date.getDay();
      const diff = day===0 ? -6 : 1-day;
      date.setDate(date.getDate()+diff);
      key = date.toISOString().slice(0,10).replace(/-/g,"");
    } else {
      key = d.slice(0,6); // YYYYMM
    }
    if(!groups[key]) groups[key] = {rawDate:key, open:c.open, high:c.high, low:c.low, close:c.close, volume:c.volume};
    else {
      groups[key].high = Math.max(groups[key].high, c.high);
      groups[key].low  = Math.min(groups[key].low,  c.low);
      groups[key].close = c.close;
      groups[key].volume += c.volume;
    }
  });
  return Object.values(groups).sort((a,b)=>a.rawDate.localeCompare(b.rawDate));
};

const formatDate = (rawDate, unit) => {
  if(!rawDate) return "";
  const s = String(rawDate);
  if(unit === "D") return `${s.slice(4,6)}/${s.slice(6,8)}`;
  if(unit === "W") return `${s.slice(4,6)}/${s.slice(6,8)}`;
  return `${s.slice(0,4)}/${s.slice(4,6)}`;
};

// ë‹¨ìœ„ë³„ ì°¨íŠ¸ ë°ì´í„° (ê°€ê²©/EMAìš©)
const enrichChart = (candles, unit="D") => {
  const grouped = groupCandles(candles, unit);
  const closes = grouped.map(c=>c.close);
  const ema20=calcEMA(closes,20), ema60=calcEMA(closes,60), rsi=calcRSI(closes,14);
  return grouped.map((c,i)=>({
    ...c,
    date: formatDate(c.rawDate, unit),
    ema20:ema20[i], ema60:ema60[i], rsi:rsi[i],
  }));
};

// ì¼ë´‰ ê¸°ì¤€ Xì¶•ì— ì¼ë´‰/ì£¼ë´‰/ì›”ë´‰ RSIë¥¼ ëª¨ë‘ ë§¤í•‘
const enrichMultiRSI = (candles) => {
  if(!candles.length) return [];

  // ì¼ë´‰ RSI
  const dailyCloses = candles.map(c=>c.close);
  const dailyRSI = calcRSI(dailyCloses, 14);

  // ì£¼ë´‰ ì§‘ê³„ í›„ RSI â†’ ë§ˆì§€ë§‰ ë‚ ì§œì— ë§¤í•‘
  const weekly = groupCandles(candles, "W");
  const weeklyRSI = calcRSI(weekly.map(c=>c.close), 14);
  // ì£¼ë´‰ RSIë¥¼ ë‚ ì§œ Mapìœ¼ë¡œ ë³€í™˜ (ê° ì£¼ì˜ ë§ˆì§€ë§‰ ê±°ë˜ì¼)
  const weeklyMap = {};
  weekly.forEach((w,i)=>{
    // í•´ë‹¹ ì£¼ì— ì†í•˜ëŠ” ì¼ë´‰ ì¤‘ ë§ˆì§€ë§‰ ë‚ ì„ ì°¾ìŒ
    const weekKey = w.rawDate; // ì£¼ ì‹œì‘ì¼(ì›”ìš”ì¼) YYYYMMDD
    const weekStart = parseInt(weekKey);
    // í•´ë‹¹ ì£¼ì— ì†í•˜ëŠ” candle ì¤‘ ë§ˆì§€ë§‰ rawDate
    const inWeek = candles.filter(c=>{
      const d = new Date(c.rawDate.slice(0,4), c.rawDate.slice(4,6)-1, c.rawDate.slice(6,8));
      const day = d.getDay();
      const diff = day===0?-6:1-day;
      d.setDate(d.getDate()+diff);
      const mondayStr = d.toISOString().slice(0,10).replace(/-/g,"");
      return mondayStr === weekKey;
    });
    if(inWeek.length) weeklyMap[inWeek[inWeek.length-1].rawDate] = weeklyRSI[i];
  });

  // ì›”ë´‰ ì§‘ê³„ í›„ RSI â†’ ë§ˆì§€ë§‰ ë‚ ì§œì— ë§¤í•‘
  const monthly = groupCandles(candles, "M");
  const monthlyRSI = calcRSI(monthly.map(c=>c.close), 14);
  const monthlyMap = {};
  monthly.forEach((m,i)=>{
    const monthKey = m.rawDate.slice(0,6); // YYYYMM
    const inMonth = candles.filter(c=>c.rawDate.slice(0,6)===monthKey);
    if(inMonth.length) monthlyMap[inMonth[inMonth.length-1].rawDate] = monthlyRSI[i];
  });

  return candles.map((c,i)=>({
    date: formatDate(c.rawDate, "D"),
    rsiD: dailyRSI[i],
    rsiW: weeklyMap[c.rawDate] ?? null,
    rsiM: monthlyMap[c.rawDate] ?? null,
  }));
};

// forward fill ì ìš© â€” ì£¼ë´‰/ì›”ë´‰ RSIë¥¼ ë‹¤ìŒ ê°’ì´ ë‚˜ì˜¬ ë•Œê¹Œì§€ ì´ì „ ê°’ìœ¼ë¡œ ì±„ì›€
const forwardFillRSI = (data) => {
  let lastW = null, lastM = null;
  return data.map(d => {
    if(d.rsiW != null) lastW = d.rsiW;
    if(d.rsiM != null) lastM = d.rsiM;
    return { ...d, rsiW: lastW, rsiM: lastM };
  });
};

// â”€â”€ ì»´í¬ë„ŒíŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const { useState, useEffect, useRef, useCallback } = React;
const { LineChart,Line,XAxis,YAxis,CartesianGrid,Tooltip,ResponsiveContainer,ReferenceLine } = Recharts;

const Skel = ({w="100%",h=14}) => (
  <div style={{width:w,height:h,borderRadius:4,background:"#1e293b",animation:"pulse 1.5s infinite"}}/>
);

const RSIMeter = ({value}) => {
  if(value==null) return <span style={{color:"#475569",fontSize:11}}>â€”</span>;
  const color = value>=70?"#ef4444":value<=30?"#22c55e":"#94a3b8";
  const label = value>=70?"ê³¼ë§¤ìˆ˜":value<=30?"ê³¼ë§¤ë„":"ì¤‘ë¦½";
  return (
    <div style={{width:"100%"}}>
      <div style={{display:"flex",justifyContent:"space-between",fontSize:10,marginBottom:3}}>
        <span style={{color,fontWeight:700}}>{value.toFixed(1)}</span>
        <span style={{color}}>{label}</span>
      </div>
      <div style={{height:4,borderRadius:4,background:"#1e293b",overflow:"hidden"}}>
        <div style={{height:"100%",width:`${value}%`,background:color,borderRadius:4,transition:"width 0.5s"}}/>
      </div>
    </div>
  );
};

const Signal = ({ema20,ema60}) => {
  if(!ema20||!ema60) return null;
  const bull = ema20>ema60;
  return <span style={{fontSize:11,padding:"2px 10px",borderRadius:20,fontWeight:700,background:bull?"#064e3b":"#450a0a",color:bull?"#34d399":"#f87171"}}>{bull?"â–² ê³¨ë“ í¬ë¡œìŠ¤":"â–¼ ë°ë“œí¬ë¡œìŠ¤"}</span>;
};

// â”€â”€ ë©”ì¸ ì•± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
  const [etfs,setEtfs]           = useState([]);
  const [selected,setSelected]   = useState(null);

  const [rawCandles,setRawCandles] = useState([]); // ì›ë³¸ ì¼ë´‰ ë°ì´í„°
  const [chartUnit,setChartUnit] = useState("D");  // D/W/M
  const [chartType,setChartType] = useState("price");
  const [chartLoading,setChartLoading] = useState(false);
  const [serverOk,setServerOk]   = useState(null);
  const [lastUpdate,setLastUpdate] = useState(null);
  const [sideOpen,setSideOpen]   = useState(true);
  const [mobileTab,setMobileTab] = useState("list"); // "list" | "detail"
  const [isMobile,setIsMobile] = useState(window.innerWidth <= 600);
  useEffect(()=>{
    const onResize = () => {
      const mobile = window.innerWidth <= 600;
      setIsMobile(mobile);
      // ê°€ë¡œ ì „í™˜ ì‹œ íƒ­ ìƒíƒœ ë¦¬ì…‹
      if(!mobile) setMobileTab("list");
    };
    window.addEventListener("resize", onResize);
    return () => window.removeEventListener("resize", onResize);
  },[]);


  useEffect(()=>{
    fetch(`${API}/api/health`).then(r=>r.ok?setServerOk(true):setServerOk(false)).catch(()=>setServerOk(false));
  },[]);

  const fetchPrices = useCallback(async(etfList)=>{
    if(!etfList||!etfList.length) return;
    const results = await Promise.allSettled(
      etfList.map(e=>fetch(`${API}/api/price/${e.ticker}`).then(r=>r.json()))
    );
    setEtfs(prev=>prev.map((e,i)=>{
      const r=results[i];
      if(r.status==="fulfilled"&&r.value.price){ const {name:_ignore, ...rest}=r.value; return{...e,...rest, loading:false,error:false}; }
      return{...e,loading:false,error:true};
    }));
    setLastUpdate(new Date());
  },[]);

  // KVì—ì„œ ETF ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
  const fetchEtfList = useCallback(async()=>{
    try {
      const r = await fetch(`${API}/api/etf/list`);
      const d = await r.json();
      const list = d.list || [];
      if(list.length === 0) return [];
      setEtfs(list.map(e=>({...e,loading:true})));
      if(list.length>0) setSelected(prev=>prev||list[0].ticker);
      fetchPrices(list);
      return list;
    } catch(e) { return []; }
  },[fetchPrices]);



  const fetchChart = useCallback(async(ticker)=>{
    setChartLoading(true);
    try{
      const r=await fetch(`${API}/api/chart/${ticker}?period=600`);
      const d=await r.json();
      // rawDate ë³´ì¡´
      const candles = (d.candles||[]).map(c=>({...c, rawDate:c.date}));
      setRawCandles(candles);
    }catch{ setRawCandles([]); }
    finally{ setChartLoading(false); }
  },[]);

  useEffect(()=>{
    fetchEtfList().then(list=>{
      if(list.length>0) fetchChart(list[0].ticker);
    });
  },[]);

  useEffect(()=>{ if(selected) fetchChart(selected); },[selected]);

  const cur = etfs.find(e=>e.ticker===selected)??{};

  // ë‹¨ìœ„ë³„ ì°¨íŠ¸ ë°ì´í„° ê³„ì‚°
  const chartData = enrichChart(rawCandles, chartUnit);
  const multiRSI = forwardFillRSI(enrichMultiRSI(rawCandles));
  const display = chartData.slice(-60);
  const displayRSI = multiRSI.slice(-60);
  const lastBar = chartData[chartData.length-1];
  const lastRSI = multiRSI[multiRSI.length-1];

  const safeTop = "env(safe-area-inset-top, 0px)";
  const safeBottom = "env(safe-area-inset-bottom, 0px)";

  const unitBtnStyle = (u) => ({
    padding:"4px 12px", borderRadius:6, fontSize:11, fontWeight:600,
    background: chartUnit===u?"#1e3a5f":"transparent",
    border: chartUnit===u?"1px solid #38bdf8":"1px solid #1e293b",
    color: chartUnit===u?"#38bdf8":"#64748b",
  });

  return (
    <div style={{display:"flex",flexDirection:"column",height:"100%",paddingTop:safeTop,paddingBottom:safeBottom}}>

      {/* í—¤ë” */}
      <div style={{borderBottom:"1px solid #1e293b",padding:"12px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0}}>
        <div style={{display:"flex",alignItems:"center",gap:10}}>
          <button onClick={()=>setSideOpen(o=>!o)} style={{background:"none",border:"none",color:"#64748b",fontSize:18,padding:"0 4px",lineHeight:1}}>â˜°</button>
          <div style={{width:8,height:8,borderRadius:"50%",background:serverOk===null?"#f59e0b":serverOk?"#22c55e":"#ef4444",boxShadow:`0 0 8px ${serverOk?"#22c55e":"#ef4444"}`,animation:"pulse 2s infinite"}}/>
          <span style={{fontSize:15,fontWeight:700,letterSpacing:"0.1em"}}>ETF MONITOR</span>
          <span style={{fontSize:10,padding:"2px 8px",borderRadius:4,background:serverOk?"#064e3b":"#450a0a",color:serverOk?"#34d399":"#f87171"}}>
            {serverOk===null?"ì—°ê²° ì¤‘â€¦":serverOk?"KIS ì—°ê²°ë¨":"ì˜¤í”„ë¼ì¸"}
          </span>
        </div>
        <div style={{fontSize:11,color:"#475569"}}>
          {lastUpdate?lastUpdate.toLocaleTimeString("ko-KR"):"â€”"}
        </div>
      </div>

      <div className="main-layout">

        {/* â”€â”€ ì‚¬ì´ë“œë°” â”€â”€ */}
        {sideOpen && (
          <div className="sidebar fade-in" style={{
            display: isMobile && mobileTab==="detail" ? "none" : "flex",
            flexDirection:"column"
          }}>
            <div className="sidebar-list">
            {etfs.map(e=>(
              <div key={e.ticker} onClick={()=>{setSelected(e.ticker); if(isMobile) setMobileTab("detail");}}
                style={{padding:"12px 14px",cursor:"pointer",
                  borderLeft:selected===e.ticker?"2px solid #38bdf8":"2px solid transparent",
                  background:selected===e.ticker?"#0f172a":"transparent",transition:"all 0.15s"}}>

                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
                  <div style={{flex:1,minWidth:0,marginRight:8}}>
                    {/* â˜… 1ë²ˆ ìˆ˜ì •: ì¢…ëª©ëª… í¬ê²Œ, ì½”ë“œ ì‘ê²Œ */}
                    <div style={{fontWeight:700,fontSize:13,color:selected===e.ticker?"#38bdf8":"#f1f5f9",
                      whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>
                      {e.name}
                    </div>
                    <div style={{fontSize:10,color:"#475569",marginTop:2}}>{e.ticker}</div>
                  </div>
                  <div style={{textAlign:"right",flexShrink:0}}>
                    {e.loading?<Skel w={55} h={12}/>:<>
                      <div style={{fontWeight:700,fontSize:12}}>{e.price?.toLocaleString()??'â€”'}</div>
                      <div style={{fontSize:11,color:(e.change_pct??0)>=0?"#22c55e":"#ef4444"}}>
                        {(e.change_pct??0)>=0?"+":""}{e.change_pct?.toFixed(2)??"â€”"}%
                      </div>
                    </>}
                  </div>
                </div>


                {selected===e.ticker&&lastBar?.rsi!=null&&(
                  <div style={{marginTop:8}}><RSIMeter value={lastBar.rsi}/></div>
                )}
              </div>
            ))}
            </div>
          </div>
        )}

        {/* â”€â”€ ë©”ì¸ íŒ¨ë„ â”€â”€ */}
        <div className={`detail-panel fade-in${isMobile&&mobileTab==="detail"?" mobile-detail-only":""}`}
          style={{display: isMobile && mobileTab==="list" ? "none" : undefined}}>

          {/* ëª¨ë°”ì¼ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */}
          {isMobile && mobileTab==="detail" && (
            <button onClick={()=>setMobileTab("list")}
              style={{display:"flex",alignItems:"center",gap:6,marginBottom:10,padding:"6px 10px",
                background:"transparent",border:"none",color:"#38bdf8",fontSize:13,cursor:"pointer"}}>
              â† ëª©ë¡ìœ¼ë¡œ
            </button>
          )}
          {/* ì¢…ëª© í—¤ë” â€” sticky */}
          <div className="sticky-header">
            <div style={{display:"flex",alignItems:"baseline",gap:10,flexWrap:"wrap"}}>
              <span style={{fontSize:20,fontWeight:800,color:"#f8fafc"}}>{cur.name}</span>
              <span style={{fontSize:11,color:"#64748b"}}>{cur.ticker}</span>
              {lastBar&&<Signal ema20={lastBar.ema20} ema60={lastBar.ema60}/>}
            </div>
            <div style={{marginTop:6,fontSize:26,fontWeight:700}}>
              {cur.loading?<Skel w={150} h={26}/>:<>
                {cur.price?.toLocaleString()??'â€”'}ì›
                <span style={{fontSize:14,marginLeft:10,color:(cur.change_pct??0)>=0?"#22c55e":"#ef4444"}}>
                  {(cur.change_pct??0)>=0?"+":""}{cur.change?.toLocaleString()??'â€”'} ({(cur.change_pct??0)>=0?"+":""}{cur.change_pct?.toFixed(2)??"â€”"}%)
                </span>
              </>}
            </div>
          </div>

          {/* ì§€í‘œ ì¹´ë“œ */}
          <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,marginBottom:16}}>
            {[
              {label:"ê³ ê°€",value:cur.high?.toLocaleString(),color:"#22c55e"},
              {label:"ì €ê°€",value:cur.low?.toLocaleString(),color:"#ef4444"},
              {label:"EMA 20",value:lastBar?.ema20?.toLocaleString(),color:"#f59e0b"},
              {label:"EMA 60",value:lastBar?.ema60?.toLocaleString(),color:"#a78bfa"},
              {label:"RSI ì¼ë´‰",value:lastRSI?.rsiD?.toFixed(1),color:lastRSI?.rsiD>=70?"#ef4444":lastRSI?.rsiD<=30?"#22c55e":"#94a3b8"},
              {label:"ê±°ë˜ëŸ‰",value:cur.volume?.toLocaleString(),color:"#38bdf8"},
            ].map(c=>(
              <div key={c.label} style={{background:"#0f172a",border:"1px solid #1e293b",borderRadius:8,padding:"8px 12px"}}>
                <div style={{fontSize:10,color:"#475569",marginBottom:3}}>{c.label}</div>
                {cur.loading?<Skel w={50} h={14}/>:<div style={{fontSize:13,fontWeight:700,color:c.color}}>{c.value??'â€”'}</div>}
              </div>
            ))}
          </div>

          {/* ì°¨íŠ¸ ì»¨íŠ¸ë¡¤ */}
          <div style={{display:"flex",gap:8,marginBottom:10,flexWrap:"wrap",alignItems:"center"}}>
            {/* ì°¨íŠ¸ íƒ€ì… */}
            {[["price","ê°€ê²© + EMA"],["rsi","RSI"]].map(([t,label])=>(
              <button key={t} onClick={()=>setChartType(t)} style={{padding:"5px 14px",borderRadius:6,fontSize:12,fontWeight:600,
                background:chartType===t?"#1e293b":"transparent",
                border:chartType===t?"1px solid #38bdf8":"1px solid #1e293b",
                color:chartType===t?"#38bdf8":"#64748b"}}>
                {label}
              </button>
            ))}

            {/* ì¼ë´‰/ì£¼ë´‰/ì›”ë´‰ ë²„íŠ¼ â€” ê°€ê²©+EMA íƒ­ì—ì„œë§Œ í‘œì‹œ */}
            {chartType==="price" && (
              <div style={{display:"flex",gap:4,marginLeft:8,background:"#0f172a",padding:3,borderRadius:7,border:"1px solid #1e293b"}}>
                {[["D","ì¼ë´‰"],["W","ì£¼ë´‰"],["M","ì›”ë´‰"]].map(([u,label])=>(
                  <button key={u} onClick={()=>setChartUnit(u)} style={unitBtnStyle(u)}>
                    {label}
                  </button>
                ))}
              </div>
            )}

            <button onClick={()=>{fetchPrices();fetchChart(selected);}}
              style={{marginLeft:"auto",padding:"5px 12px",borderRadius:6,fontSize:12,fontWeight:600,background:"transparent",border:"1px solid #1e293b",color:"#64748b"}}>
              âŸ³
            </button>
          </div>

          {/* ì°¨íŠ¸ */}
          <div style={{background:"#0a1020",border:"1px solid #1e293b",borderRadius:10,padding:"14px 4px",position:"relative"}}>
            {chartLoading&&(
              <div style={{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"#0a1020cc",borderRadius:10,zIndex:10}}>
                <div style={{width:24,height:24,border:"2px solid #38bdf8",borderTopColor:"transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}/>
              </div>
            )}

            {chartType==="price"?(
              <>
                <ResponsiveContainer width="100%" height={220}>
                  <LineChart data={display}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#1e293b"/>
                    <XAxis dataKey="date" tick={{fontSize:9,fill:"#475569"}} interval={Math.floor(display.length/6)}/>
                    <YAxis domain={["auto","auto"]} tick={{fontSize:9,fill:"#475569"}} width={62} tickFormatter={v=>v.toLocaleString()}/>
                    <Tooltip contentStyle={{background:"#0f172a",border:"1px solid #1e293b",borderRadius:6,fontSize:11}}
                      formatter={(v,name)=>[v?.toLocaleString(),name==="close"?"ì¢…ê°€":name==="ema20"?"EMA 20":"EMA 60"]}/>
                    <Line type="monotone" dataKey="close" stroke="#e2e8f0" dot={false} strokeWidth={1.5}/>
                    <Line type="monotone" dataKey="ema20" stroke="#f59e0b" dot={false} strokeWidth={1.5} strokeDasharray="4 2"/>
                    <Line type="monotone" dataKey="ema60" stroke="#a78bfa" dot={false} strokeWidth={1.5} strokeDasharray="4 2"/>
                  </LineChart>
                </ResponsiveContainer>
                <div style={{display:"flex",gap:16,justifyContent:"center",marginTop:8}}>
                  {[["ì¢…ê°€","#e2e8f0"],["EMA 20","#f59e0b"],["EMA 60","#a78bfa"]].map(([l,c])=>(
                    <div key={l} style={{display:"flex",alignItems:"center",gap:5,fontSize:10,color:"#64748b"}}>
                      <div style={{width:16,height:2,background:c}}/>{l}
                    </div>
                  ))}
                </div>

                {/* EMA í•´ì„ ê°€ì´ë“œ */}
                {(()=>{
                  const ema20 = lastBar?.ema20;
                  const ema60 = lastBar?.ema60;
                  const price = cur.price;
                  if(!ema20||!ema60||!price) return null;

                  const cross = ema20>ema60 ? "golden" : "dead";

                  // ê°€ê²© ìœ„ì¹˜ íŒë‹¨
                  let position, posColor, posDesc;
                  if(price>ema20&&ema20>ema60){
                    position="ê°•í•œ ìƒìŠ¹ ì¶”ì„¸"; posColor="#22c55e";
                    posDesc="ê°€ê²© > EMA20 > EMA60 â€” ì¶”ì„¸ê°€ íƒ„íƒ„í•˜ê²Œ ìœ ì§€ë˜ê³  ìˆì–´ìš”.";
                  } else if(ema20>price&&price>ema60){
                    position="ì¡°ì • ì¤‘ (ì¤‘ê¸° ì¶”ì„¸ ìœ ì§€)"; posColor="#f59e0b";
                    posDesc="EMA20 > ê°€ê²© > EMA60 â€” ë‹¨ê¸° ì¡°ì •ì´ì§€ë§Œ ì¤‘ê¸° ìƒìŠ¹ ì¶”ì„¸ëŠ” ì‚´ì•„ìˆì–´ìš”.";
                  } else if(ema20>ema60&&ema60>price){
                    position="ë‹¨ê¸° ê³¼ë§¤ë„ (ë°˜ë“± ê°€ëŠ¥)"; posColor="#38bdf8";
                    posDesc="EMA20 > EMA60 > ê°€ê²© â€” ì¶”ì„¸ëŠ” ìƒìŠ¹ì´ì§€ë§Œ ê°€ê²©ì´ ë„ˆë¬´ ë‚´ë ¤ì™”ì–´ìš”. ë°˜ë“± ê°€ëŠ¥ì„± ìˆì–´ìš”.";
                  } else if(price<ema20&&ema20<ema60){
                    position="ê°•í•œ í•˜ë½ ì¶”ì„¸"; posColor="#ef4444";
                    posDesc="ê°€ê²© < EMA20 < EMA60 â€” ì¶”ì„¸ê°€ í•˜ë½ìœ¼ë¡œ ì •ë ¬ë¼ ìˆì–´ìš”. ì‹ ì¤‘í•˜ê²Œ ì ‘ê·¼í•˜ì„¸ìš”.";
                  } else {
                    position="ì¶”ì„¸ ì „í™˜ êµ¬ê°„"; posColor="#94a3b8";
                    posDesc="EMAì™€ ê°€ê²©ì´ í˜¼ì¬ â€” ë°©í–¥ì„±ì´ ë¶ˆëª…í™•í•œ êµ¬ê°„ì´ì—ìš”. ê´€ë§ì„ ê¶Œì¥í•´ìš”.";
                  }

                  // EMA ê°„ê²© íŒë‹¨
                  const gap = Math.abs(ema20-ema60)/ema60*100;
                  let gapDesc;
                  if(gap>3) gapDesc="ë‘ ì„ ì˜ ê°„ê²©ì´ ë„“ì–´ìš” â†’ í˜„ì¬ ì¶”ì„¸ê°€ ê°•í•˜ê²Œ ìœ ì§€ë˜ê³  ìˆì–´ìš”.";
                  else if(gap>1) gapDesc="ë‘ ì„ ì˜ ê°„ê²©ì´ ì¢ì•„ì§€ê³  ìˆì–´ìš” â†’ ì¶”ì„¸ ì „í™˜(í¬ë¡œìŠ¤) ê°€ëŠ¥ì„±ì„ ì£¼ì‹œí•˜ì„¸ìš”.";
                  else gapDesc="ë‘ ì„ ì´ ê±°ì˜ ë¶™ì–´ìˆì–´ìš” â†’ í¬ë¡œìŠ¤ ì„ë°•! ë°©í–¥ ì „í™˜ ì‹ í˜¸ì— ì£¼ëª©í•˜ì„¸ìš”.";

                  return (
                    <div style={{marginTop:12,padding:"12px 14px",background:"#0b1628",border:"1px solid #1e293b",borderRadius:8,fontSize:11,lineHeight:2}}>
                      <div style={{color:"#94a3b8",fontWeight:700,marginBottom:6,fontSize:12}}>ğŸ“Š EMA ì‹ í˜¸ ë¶„ì„</div>

                      {/* í¬ë¡œìŠ¤ ìƒíƒœ */}
                      <div style={{marginBottom:4}}>
                        <span style={{color: cross==="golden"?"#34d399":"#f87171", fontWeight:700}}>
                          {cross==="golden"?"â–² ê³¨ë“ í¬ë¡œìŠ¤":"â–¼ ë°ë“œí¬ë¡œìŠ¤"}
                        </span>
                        <span style={{color:"#64748b",marginLeft:8}}>
                          {cross==="golden"
                            ? "EMA20 > EMA60 â€” ë‹¨ê¸° í‰ê· ì´ ì¤‘ê¸°ë¥¼ ë„˜ì–´ì„  ìƒìŠ¹ ì‹ í˜¸"
                            : "EMA20 < EMA60 â€” ë‹¨ê¸° í‰ê· ì´ ì¤‘ê¸° ì•„ë˜ë¡œ êº¾ì¸ í•˜ë½ ì‹ í˜¸"}
                        </span>
                      </div>

                      {/* ê°€ê²© ìœ„ì¹˜ */}
                      <div style={{marginBottom:4}}>
                        <span style={{color:posColor,fontWeight:700}}>{position}</span>
                        <span style={{color:"#64748b",marginLeft:8}}>{posDesc}</span>
                      </div>

                      {/* ê°„ê²© ë¶„ì„ */}
                      <div>
                        <span style={{color:"#475569"}}>ê°„ê²© {gap.toFixed(1)}%</span>
                        <span style={{color:"#64748b",marginLeft:8}}>{gapDesc}</span>
                      </div>
                    </div>
                  );
                })()}

                {/* ë‹¨ìœ„ë³„ EMA ê°€ì´ë“œ */}
                <div style={{marginTop:10,padding:"12px 14px",background:"#080c14",border:"1px solid #1e293b",borderRadius:8,fontSize:11,lineHeight:2,color:"#475569"}}>
                  <div style={{color:"#64748b",fontWeight:700,marginBottom:6}}>
                    ğŸ“– EMA ì½ëŠ” ë²• ({chartUnit==="D"?"ì¼ë´‰":chartUnit==="W"?"ì£¼ë´‰":"ì›”ë´‰"} ê¸°ì¤€)
                  </div>

                  {/* ê³µí†µ: ê³¨ë“ /ë°ë“œí¬ë¡œìŠ¤ */}
                  <div style={{marginBottom:6}}>
                    <span style={{color:"#94a3b8",fontWeight:600}}>â‘  ê³¨ë“ /ë°ë“œí¬ë¡œìŠ¤</span><br/>
                    <span style={{color:"#34d399"}}>â–² ê³¨ë“ í¬ë¡œìŠ¤</span> â€” EMA20ì´ EMA60ì„ ì•„ë˜â†’ìœ„ ëŒíŒŒ Â· ìƒìŠ¹ ì¶”ì„¸ ì „í™˜ ì‹ í˜¸<br/>
                    <span style={{color:"#f87171"}}>â–¼ ë°ë“œí¬ë¡œìŠ¤</span> â€” EMA20ì´ EMA60ì„ ìœ„â†’ì•„ë˜ ëŒíŒŒ Â· í•˜ë½ ì¶”ì„¸ ì „í™˜ ì‹ í˜¸
                  </div>

                  {/* ê³µí†µ: ê°€ê²© ìœ„ì¹˜ */}
                  <div style={{marginBottom:6}}>
                    <span style={{color:"#94a3b8",fontWeight:600}}>â‘¡ ê°€ê²© ìœ„ì¹˜ë¡œ ì¶”ì„¸ íŒë‹¨</span><br/>
                    <span style={{color:"#22c55e"}}>ê°€ê²© &gt; EMA20 &gt; EMA60</span> â†’ ê°•í•œ ìƒìŠ¹ ì¶”ì„¸<br/>
                    <span style={{color:"#f59e0b"}}>EMA20 &gt; ê°€ê²© &gt; EMA60</span> â†’ ì¡°ì • ì¤‘, ì¤‘ê¸° ì¶”ì„¸ ìœ ì§€<br/>
                    <span style={{color:"#38bdf8"}}>EMA20 &gt; EMA60 &gt; ê°€ê²©</span> â†’ ë‹¨ê¸° ê³¼ë§¤ë„, ë°˜ë“± ê°€ëŠ¥ì„±<br/>
                    <span style={{color:"#ef4444"}}>ê°€ê²© &lt; EMA20 &lt; EMA60</span> â†’ ê°•í•œ í•˜ë½ ì¶”ì„¸
                  </div>

                  {/* ë‹¨ìœ„ë³„ í•´ì„ */}
                  {chartUnit==="D" && (
                    <div style={{marginBottom:6}}>
                      <span style={{color:"#94a3b8",fontWeight:600}}>â‘¢ ì¼ë´‰ EMA íŠ¹ì§•</span><br/>
                      í•˜ë£¨í•˜ë£¨ ë…¸ì´ì¦ˆê°€ ë§ì•„ ì†ì„ìˆ˜ ì‹ í˜¸ê°€ ìƒê¸¸ ìˆ˜ ìˆì–´ìš”.<br/>
                      ì¼ë´‰ ê³¨ë“ í¬ë¡œìŠ¤ë§Œìœ¼ë¡œ íŒë‹¨í•˜ë©´ ìœ„í—˜ â€” ì£¼ë´‰/ì›”ë´‰ë„ í•¨ê»˜ í™•ì¸í•˜ì„¸ìš”.<br/>
                      ë‹¨ê¸° íŠ¸ë ˆì´ë”©(ìˆ˜ì¼~ìˆ˜ì£¼) íƒ€ì´ë° í¬ì°©ì— ìœ ìš©í•´ìš”.
                    </div>
                  )}
                  {chartUnit==="W" && (
                    <div style={{marginBottom:6}}>
                      <span style={{color:"#94a3b8",fontWeight:600}}>â‘¢ ì£¼ë´‰ EMA íŠ¹ì§•</span><br/>
                      5ì¼ì¹˜ë¥¼ ì••ì¶•í•´ ì¼ë´‰ë³´ë‹¤ ì‹ ë¢°ë„ê°€ í›¨ì”¬ ë†’ì•„ìš”.<br/>
                      ì£¼ë´‰ EMA20ì´ ìš°ìƒí–¥ ì¤‘ì´ë¼ë©´ ì¼ë´‰ í•˜ë½ì€ ë‹¨ê¸° ì¡°ì •ì¼ ê°€ëŠ¥ì„±ì´ ë†’ì•„ìš”.<br/>
                      ì£¼ë´‰ ë°ë“œí¬ë¡œìŠ¤ â†’ ìˆ˜ì£¼~ìˆ˜ê°œì›” ë‹¨ìœ„ í•˜ë½ ì¶”ì„¸ ì§„ì… ì‹ í˜¸ë¡œ ë´ìš”.
                    </div>
                  )}
                  {chartUnit==="M" && (
                    <div style={{marginBottom:6}}>
                      <span style={{color:"#94a3b8",fontWeight:600}}>â‘¢ ì›”ë´‰ EMA íŠ¹ì§•</span><br/>
                      ì¥ê¸° íˆ¬ììì˜ ê´€ì  â€” ë‹¨ê¸° ë“±ë½ì— ì „í˜€ í”ë“¤ë¦¬ì§€ ì•Šì•„ìš”.<br/>
                      ì›”ë´‰ ê³¨ë“ í¬ë¡œìŠ¤ â†’ ìˆ˜ë…„ ë‹¨ìœ„ ì¥ê¸° ìƒìŠ¹ ì‚¬ì´í´ ì§„ì… ì‹ í˜¸<br/>
                      ì›”ë´‰ ë°ë“œí¬ë¡œìŠ¤ â†’ 2008ë…„ ê¸ˆìœµìœ„ê¸°, 2022ë…„ í•˜ë½ì¥ ê°™ì€ êµ¬ì¡°ì  í•˜ë½ì˜ ì‹ í˜¸ì˜€ì–´ìš”.
                    </div>
                  )}

                  {/* ê³µí†µ: ì„¸ ì‹œê°„ëŒ€ ì¢…í•© íŒë‹¨ */}
                  <div>
                    <span style={{color:"#94a3b8",fontWeight:600}}>â‘£ ì„¸ ì‹œê°„ëŒ€ ì¢…í•© íŒë‹¨</span><br/>
                    ì¼ë´‰ë§Œ ê³¨ë“ í¬ë¡œìŠ¤ â†’ ë‹¨ê¸° ë°˜ë“±, ì‹ ì¤‘í•˜ê²Œ<br/>
                    ì¼ë´‰ + ì£¼ë´‰ ê³¨ë“ í¬ë¡œìŠ¤ â†’ ì‹ ë¢°ë„ ë†’ì€ ìƒìŠ¹ ì‹ í˜¸<br/>
                    ì¼ë´‰ + ì£¼ë´‰ + ì›”ë´‰ ëª¨ë‘ ê³¨ë“ í¬ë¡œìŠ¤ â†’ ê°•í•œ ì¥ê¸° ìƒìŠ¹ ì¶”ì„¸<br/>
                    <span style={{color:"#f87171"}}>ì›”ë´‰ ë°ë“œí¬ë¡œìŠ¤ + ì¼ë´‰ ê³¨ë“ í¬ë¡œìŠ¤</span> â†’ í•˜ë½ ì¶”ì„¸ ì† ë‹¨ê¸° ë°˜ë“±, ë§¤ìš° ì£¼ì˜
                  </div>
                </div>
              </>
            ):(
              <>
                {/* RSI ì°¨íŠ¸ â€” ì¼ë´‰/ì£¼ë´‰/ì›”ë´‰ í•œ ê·¸ë˜í”„ */}
                <div style={{fontSize:11,color:"#475569",padding:"0 8px 8px",fontWeight:600}}>
                  RSI (14) Â· ì¼ë´‰ + ì£¼ë´‰ + ì›”ë´‰
                </div>
                <ResponsiveContainer width="100%" height={240}>
                  <LineChart data={displayRSI}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#1e293b"/>
                    <XAxis dataKey="date" tick={{fontSize:9,fill:"#475569"}} interval={Math.floor(displayRSI.length/6)}/>
                    <YAxis domain={[0,100]} tick={{fontSize:9,fill:"#475569"}} width={32}/>
                    <Tooltip
                      contentStyle={{background:"#0f172a",border:"1px solid #1e293b",borderRadius:6,fontSize:11}}
                      formatter={(v,name)=>{
                        if(v==null) return null;
                        const label = name==="rsiD"?"ì¼ë´‰ RSI":name==="rsiW"?"ì£¼ë´‰ RSI":"ì›”ë´‰ RSI";
                        return [v.toFixed(1), label];
                      }}
                    />
                    <ReferenceLine y={70} stroke="#ef4444" strokeDasharray="4 2"
                      label={{value:"ê³¼ë§¤ìˆ˜(70)",fill:"#ef4444",fontSize:9,position:"insideTopLeft"}}/>
                    <ReferenceLine y={50} stroke="#475569" strokeDasharray="2 4"/>
                    <ReferenceLine y={30} stroke="#22c55e" strokeDasharray="4 2"
                      label={{value:"ê³¼ë§¤ë„(30)",fill:"#22c55e",fontSize:9,position:"insideBottomLeft"}}/>
                    <Line type="monotone" dataKey="rsiD" stroke="#38bdf8" dot={false} strokeWidth={1.5} connectNulls={false}/>
                    <Line type="monotone" dataKey="rsiW" stroke="#f59e0b" dot={false} strokeWidth={2} connectNulls={false}/>
                    <Line type="monotone" dataKey="rsiM" stroke="#a78bfa" dot={false} strokeWidth={2.5} connectNulls={false}/>
                  </LineChart>
                </ResponsiveContainer>
                <div style={{display:"flex",gap:16,justifyContent:"center",marginTop:8}}>
                  {[["ì¼ë´‰ RSI","#38bdf8"],["ì£¼ë´‰ RSI","#f59e0b"],["ì›”ë´‰ RSI","#a78bfa"]].map(([l,c])=>(
                    <div key={l} style={{display:"flex",alignItems:"center",gap:5,fontSize:10,color:"#64748b"}}>
                      <div style={{width:16,height:2,background:c}}/>{l}
                    </div>
                  ))}
                </div>
                <div style={{marginTop:8,padding:"8px 12px",background:"#0f172a",borderRadius:8,fontSize:11,color:"#64748b",lineHeight:1.8}}>
                  <span style={{color:"#ef4444"}}>â— â‰¥70 ê³¼ë§¤ìˆ˜</span> &nbsp;
                  <span style={{color:"#22c55e"}}>â— â‰¤30 ê³¼ë§¤ë„</span> &nbsp;
                  <span style={{color:"#94a3b8"}}>â— 30~70 ì¤‘ë¦½</span>
                </div>

                {/* RSI ìë™ ë¶„ì„ */}
                {(()=>{
                  const d = lastRSI?.rsiD;
                  const w = lastRSI?.rsiW;
                  const m = lastRSI?.rsiM;
                  if(d==null) return null;

                  const rsiLabel = (v) => {
                    if(v==null) return { text:"ë°ì´í„° ì—†ìŒ", color:"#475569" };
                    if(v>=70)   return { text:`${v.toFixed(1)} ê³¼ë§¤ìˆ˜`, color:"#ef4444" };
                    if(v<=30)   return { text:`${v.toFixed(1)} ê³¼ë§¤ë„`, color:"#22c55e" };
                    return { text:`${v.toFixed(1)} ì¤‘ë¦½`, color:"#94a3b8" };
                  };

                  // ì„¸ ì‹œê°„ëŒ€ ì¢…í•© ì‹ í˜¸
                  let signal, sigColor;
                  const overBought = [d>=70, w>=70, m>=70].filter(Boolean).length;
                  const overSold   = [d<=30, w<=30, m<=30].filter(Boolean).length;
                  if(overBought>=2){
                    signal="âš ï¸ ê³¼ë§¤ìˆ˜ êµ¬ê°„ â€” ë‹¨ê¸° ì¡°ì • ê°€ëŠ¥ì„±ì´ ë†’ì•„ìš”. ì‹ ê·œ ë§¤ìˆ˜ëŠ” ì‹ ì¤‘í•˜ê²Œ.";
                    sigColor="#ef4444";
                  } else if(overSold>=2){
                    signal="âœ… ê³¼ë§¤ë„ êµ¬ê°„ â€” ë°˜ë“± ê°€ëŠ¥ì„±ì´ ë†’ì•„ìš”. ë¶„í•  ë§¤ìˆ˜ ê³ ë ¤í•´ë³¼ ë§Œí•´ìš”.";
                    sigColor="#22c55e";
                  } else if(d>=70&&w<70){
                    signal="ğŸ“Œ ì¼ë´‰ ê³¼ë§¤ìˆ˜ì§€ë§Œ ì£¼ë´‰ì€ ì¤‘ë¦½ â€” ë‹¨ê¸° ê³¼ì—´, ì¡°ì • í›„ ì¬ì§„ì… ê³ ë ¤.";
                    sigColor="#f59e0b";
                  } else if(d<=30&&w>30){
                    signal="ğŸ“Œ ì¼ë´‰ ê³¼ë§¤ë„ì§€ë§Œ ì£¼ë´‰ì€ ì¤‘ë¦½ â€” ë‹¨ê¸° ê¸‰ë½, ë°˜ë“± ì—¬ë¶€ ì£¼ë´‰ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”.";
                    sigColor="#38bdf8";
                  } else if(d>50&&w>50&&m>50){
                    signal="ğŸ“ˆ ì¼ë´‰Â·ì£¼ë´‰Â·ì›”ë´‰ ëª¨ë‘ 50 ì´ìƒ â€” ì „ë°˜ì ì¸ ìƒìŠ¹ ëª¨ë©˜í…€ì´ ì‚´ì•„ìˆì–´ìš”.";
                    sigColor="#34d399";
                  } else if(d<50&&w<50&&m<50){
                    signal="ğŸ“‰ ì¼ë´‰Â·ì£¼ë´‰Â·ì›”ë´‰ ëª¨ë‘ 50 ì´í•˜ â€” ì „ë°˜ì ì¸ í•˜ë½ ëª¨ë©˜í…€ì´ ì§€ì†ë˜ê³  ìˆì–´ìš”.";
                    sigColor="#f87171";
                  } else {
                    signal="â– ëšœë ·í•œ ë°©í–¥ì„± ì—†ìŒ â€” ì¶”ì„¸ í™•ì¸ í›„ íŒë‹¨í•˜ì„¸ìš”.";
                    sigColor="#64748b";
                  }

                  const dLabel = rsiLabel(d);
                  const wLabel = rsiLabel(w);
                  const mLabel = rsiLabel(m);

                  return (
                    <div style={{marginTop:12,padding:"12px 14px",background:"#0b1628",border:"1px solid #1e293b",borderRadius:8,fontSize:11,lineHeight:2}}>
                      <div style={{color:"#94a3b8",fontWeight:700,marginBottom:6,fontSize:12}}>ğŸ“Š RSI ì‹ í˜¸ ë¶„ì„</div>

                      {/* ì„¸ ì‹œê°„ëŒ€ ê°’ */}
                      <div style={{display:"flex",gap:20,marginBottom:8}}>
                        <div><span style={{color:"#38bdf8"}}>ì¼ë´‰</span> <span style={{color:dLabel.color,fontWeight:700}}>{dLabel.text}</span></div>
                        <div><span style={{color:"#f59e0b"}}>ì£¼ë´‰</span> <span style={{color:wLabel.color,fontWeight:700}}>{wLabel.text}</span></div>
                        <div><span style={{color:"#a78bfa"}}>ì›”ë´‰</span> <span style={{color:mLabel.color,fontWeight:700}}>{mLabel.text}</span></div>
                      </div>

                      {/* ì¢…í•© ì‹ í˜¸ */}
                      <div style={{color:sigColor}}>{signal}</div>
                    </div>
                  );
                })()}

                {/* RSI ê³ ì • ê°€ì´ë“œ */}
                <div style={{marginTop:10,padding:"12px 14px",background:"#080c14",border:"1px solid #1e293b",borderRadius:8,fontSize:11,lineHeight:2,color:"#475569"}}>
                  <div style={{color:"#64748b",fontWeight:700,marginBottom:6}}>ğŸ“– RSI ì½ëŠ” ë²• (ê¸°ì–µìš©)</div>

                  <div style={{marginBottom:6}}>
                    <span style={{color:"#94a3b8",fontWeight:600}}>â‘  RSI ê¸°ë³¸ í•´ì„</span><br/>
                    <span style={{color:"#ef4444"}}>70 ì´ìƒ</span> â†’ ê³¼ë§¤ìˆ˜ Â· ë‹¨ê¸° ì¡°ì • ê°€ëŠ¥ì„±, ì‹ ê·œ ë§¤ìˆ˜ ìì œ<br/>
                    <span style={{color:"#22c55e"}}>30 ì´í•˜</span> â†’ ê³¼ë§¤ë„ Â· ë°˜ë“± ê°€ëŠ¥ì„±, ë¶„í•  ë§¤ìˆ˜ ê³ ë ¤<br/>
                    <span style={{color:"#94a3b8"}}>30~70</span> â†’ ì¤‘ë¦½ Â· ì¶”ì„¸ ë°©í–¥ìœ¼ë¡œ ì¶”ì¢…
                  </div>

                  <div style={{marginBottom:6}}>
                    <span style={{color:"#94a3b8",fontWeight:600}}>â‘¡ 50ì„ ì˜ ì˜ë¯¸</span><br/>
                    RSI 50 ì´ìƒ ìœ ì§€ â†’ ìƒìŠ¹ ëª¨ë©˜í…€ Â· 50 ì´í•˜ ìœ ì§€ â†’ í•˜ë½ ëª¨ë©˜í…€<br/>
                    50ì„  ëŒíŒŒ/ì´íƒˆì€ ì¶”ì„¸ ì „í™˜ì˜ ì´ˆê¸° ì‹ í˜¸ë¡œ ë³¼ ìˆ˜ ìˆì–´ìš”.
                  </div>

                  <div style={{marginBottom:6}}>
                    <span style={{color:"#94a3b8",fontWeight:600}}>â‘¢ ì¼ë´‰/ì£¼ë´‰/ì›”ë´‰ ì¢…í•© íŒë‹¨</span><br/>
                    ì¼ë´‰ë§Œ ê³¼ë§¤ìˆ˜ â†’ ë‹¨ê¸° ê³¼ì—´, ì£¼ë´‰ í™•ì¸ í•„ìš”<br/>
                    ì¼ë´‰+ì£¼ë´‰ ê³¼ë§¤ìˆ˜ â†’ ì¤‘ê¸° ê³¼ì—´, ì¡°ì • ê°€ëŠ¥ì„± ë†’ìŒ<br/>
                    ì„¸ ì‹œê°„ëŒ€ ëª¨ë‘ ê³¼ë§¤ìˆ˜ â†’ ê°•í•œ ì¡°ì • ë˜ëŠ” í•˜ë½ ì „í™˜ ê²½ê³ <br/>
                    ì„¸ ì‹œê°„ëŒ€ ëª¨ë‘ ê³¼ë§¤ë„ â†’ ê°•í•œ ë°˜ë“± ê°€ëŠ¥ì„±, ë¶„í•  ë§¤ìˆ˜ ê³ ë ¤
                  </div>

                  <div>
                    <span style={{color:"#94a3b8",fontWeight:600}}>â‘£ ì£¼ì˜ì‚¬í•­</span><br/>
                    ê°•í•œ ì¶”ì„¸ì¥ì—ì„œëŠ” RSIê°€ 70 ì´ìƒì—ì„œ ì˜¤ë˜ ë¨¸ë¬¼ ìˆ˜ ìˆì–´ìš”.<br/>
                    RSI ë‹¨ë…ë³´ë‹¤ EMA í¬ë¡œìŠ¤ì™€ í•¨ê»˜ ë³´ë©´ ì‹ ë¢°ë„ê°€ ë†’ì•„ì ¸ìš”.
                  </div>
                </div>
              </>
            )}
          </div>
        </div>
      </div>

    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
